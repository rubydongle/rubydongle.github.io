<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Read Fucking Code"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><title>PPU概述 | 咚咚！咚咚！</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">PPU概述</h1><a id="logo" href="/.">咚咚！咚咚！</a><p class="description">ruby.dongle</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">PPU概述</h1><div class="post-meta"><a href="/2019/09/03/techdoc/NES Game/PPU/PPU概述/#comments" class="comment-count"></a><p><span class="date">Sep 03, 2019</span><span><a href="/categories/技术文章/" class="category">技术文章</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>NES PPU是Picture Processing Unit的简称。  </p>
<p>It has its own address space, which typically contains 10 kilobytes of memory: 8 kilobytes of ROM or RAM on the Game Pak (possibly more with one of the common mappers) to store the shapes of background and sprite tiles, plus 2 kilobytes of RAM in the console to store a map or two. Two separate, smaller address spaces hold a palette, which controls which colors are associated to various indices, and OAM (Object Attribute Memory), which stores the position, orientation, shape, and color of the sprites, or independent moving objects. These are internal to the PPU itself, and while the palette is made of static memory, OAM uses dynamic memory (which will slowly decay if the PPU is not rendering data).</p>
<p>PPU外部：<br>PPU有自己的地址空间，常见的PPU包含10kb内存内存空间,这10kb一般来自NES卡带：<br>其中8kb在游戏卡带上的ROM或RAM上，用来存储背景或sprite贴图。<br>另外的2kb在NES卡带上的RAM存储，作为nametable地址映射到PPU的$2000-2FFF。<br>下面是PPU内存映射关系<br>|Address range    |Size    |Description<br>|—-          |—-    |<br>|$0000-$0FFF    |$1000    |Pattern table 0<br>|$1000-$1FFF    |$1000    |Pattern table 1<br>|$2000-$23FF    |$0400    |Nametable 0<br>|$2400-$27FF    |$0400    |Nametable 1<br>|$2800-$2BFF    |$0400    |Nametable 2<br>|$2C00-$2FFF    |$0400    |Nametable 3<br>|$3000-$3EFF    |$0F00    |Mirrors of $2000-$2EFF<br>|$3F00-$3F1F    |$0020    |Palette RAM indexes<br>|$3F20-$3FFF    |$00E0    |Mirrors of $3F00-$3F1F</p>
<p>PPU内部：<br>还有两个独立的小地址空间用来存储palette和OAM(Object Attribute Memory)。<br>OAM用来存储sprites或独立移动对象的位置，方向，形状和颜色。<br>这两个独立的小地址空间的内存在PPU内部，palette由static memory构成，OAM使用dynamic memory。  </p>
<h2 id="2-寄存器"><a href="#2-寄存器" class="headerlink" title="2.寄存器"></a>2.寄存器</h2><p>PPU对CPU有8个寄存器可见，这些寄存器通过内存映射的方式映射到CPU的地址空间$2000-$2700。</p>
<h2 id="3-PPU内部内存映射"><a href="#3-PPU内部内存映射" class="headerlink" title="3.PPU内部内存映射"></a>3.PPU内部内存映射</h2><p>PPU内部的有16kb的内存空间，从$0000到$3FFF。PPU可以直接访问这些内存空间，CPU也可以通过$2006和$2007访问寄存器来访问。<br>PPUADDR    $2006    aaaa aaaa    PPU read/write address (two writes: most significant byte, least significant byte)<br>PPUDATA    $2007    dddd dddd    PPU data read/write<br>第一步写入地址到$2006,由于a寄存器是8位，所以要写两次。<br>第二步在上一步设定的地址读取或写入数据  </p>
<p>如下面的代码我们设置PPUADDR为$2000,然后写入数据,PPU的内部地址$2000是Nametable 0.<br>写入数据后PPUADDR的位置会递增，所以我们下面的代码相当于将PPU的Nametable 0中的内容全部设置为0.<br>$2000-$23FF    $0400    Nametable 0  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lda #$20  ;设置PPU memory Nametable 0 $2000-23FF</span><br><span class="line">sta $2006</span><br><span class="line">lda #$00</span><br><span class="line">sta $2006</span><br><span class="line">; empty nametable</span><br><span class="line">lda #0</span><br><span class="line">ldy #30 ; 30 rows</span><br><span class="line">:</span><br><span class="line">        ldx #32 ; 32 columns</span><br><span class="line">        :</span><br><span class="line">                sta $2007</span><br><span class="line">                dex</span><br><span class="line">                bne :-</span><br><span class="line">        dey</span><br><span class="line">        bne :--</span><br></pre></td></tr></table></figure>

<h2 id="Pattern-Table-背景和sprites的贴片图"><a href="#Pattern-Table-背景和sprites的贴片图" class="headerlink" title=".Pattern Table(背景和sprites的贴片图)"></a>.Pattern Table(背景和sprites的贴片图)</h2><p>pattern table是一块连接到PPU的内存区域，这块区域定义了tiles的形状。这些tiles构成背景和sprites。<br>每个tile在pattern table中占用16bytes，分成两部分。<br>第一部分控制bit0，第二部分控制bit1.像素颜色是0的是背景或者透明的。  </p>
<h2 id="背景图"><a href="#背景图" class="headerlink" title="背景图"></a>背景图</h2><p>名称表(Nametables)<br>NES有2kb的内存给PPU使用，通常映射到Nametable的地址空间($2000-$2FFF),<br>属性表(Attribute tables)</p>
<h2 id="PPU内部内存palette"><a href="#PPU内部内存palette" class="headerlink" title="PPU内部内存palette"></a>PPU内部内存palette</h2><h2 id="PPU内部内存-OAM"><a href="#PPU内部内存-OAM" class="headerlink" title="PPU内部内存-OAM"></a>PPU内部内存-OAM</h2><p>PPU内部有256byte的OAM(Object Attribute Memroy)内存,这块内存里的数据确定如何渲染sprites。<br>CPU可以通过已经映射到CPU内存空间的内存映射寄存器OAMADDR($2003)、OAMDATA($2004)和OAMDMA($4014)来操作它。<br>OAM可以看成是有64个元素的数组，每个元素包含4byte。每个元素含义如下：  </p>
<table>
<thead>
<tr>
<th>Address Low Nibble</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>$00, $04, $08, $0C</td>
<td>Sprite Y coordinate</td>
</tr>
<tr>
<td>$01, $05, $09, $0D</td>
<td>Sprite tile #</td>
</tr>
<tr>
<td>$02, $06, $0A, $0E</td>
<td>Sprite attribute</td>
</tr>
<tr>
<td>$03, $07, $0B, $0F</td>
<td>Sprite X coordinate</td>
</tr>
</tbody></table>
<p>DMA OAM，CPU通过$4014可以通过DMA的方式写入数据到OAM内存区。<br>如向$4014写入$XX会将CPU内存页$XX00-XXFF的数据通过DMA的方式写入到PPU的OAM区域。一般通过DMA的方式传输CPU内部ram，游戏卡带上的ROM和RAM区域的数据也可以通过DMA方式传递到PPU的OAM中。  </p>
</div><div class="post-copyright"><blockquote><p>原文作者: 董宇</p><p>原文链接: <a href="https://rubydongle.github.io/2019/09/03/techdoc/NES Game/PPU/PPU概述/">https://rubydongle.github.io/2019/09/03/techdoc/NES Game/PPU/PPU概述/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2019/09/04/techdoc/MM/页表/" class="pre">页表</a><a href="/2019/09/03/techdoc/NES Game/Nes卡带启动流程/" class="next">Nes卡带启动流程</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#概述"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-寄存器"><span class="toc-text">2.寄存器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-PPU内部内存映射"><span class="toc-text">3.PPU内部内存映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pattern-Table-背景和sprites的贴片图"><span class="toc-text">.Pattern Table(背景和sprites的贴片图)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#背景图"><span class="toc-text">背景图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PPU内部内存palette"><span class="toc-text">PPU内部内存palette</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PPU内部内存-OAM"><span class="toc-text">PPU内部内存-OAM</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/09/24/伪终端使用/">伪终端使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/18/安装WordPress/">安装WordPress</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/17/php安装/">php安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/17/mysql安装/">mysql安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/17/nginx安装/">nginx安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/17/服务器搭建/">服务器搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/15/LVM/">LVM</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/15/pythonNotebook环境/">pythonNotebook环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/15/pythonQt/">pythonQt</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/15/shadowsocks使用/">shadowsocks使用</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/使用方法/">使用方法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术文章/">技术文章</a><span class="category-list-count">31</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/服务器/" style="font-size: 15px;">服务器</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/ShadowSocks/" style="font-size: 15px;">ShadowSocks</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Art/" style="font-size: 15px;">Art</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/内核/" style="font-size: 15px;">内核</a> <a href="/tags/内存/" style="font-size: 15px;">内存</a> <a href="/tags/Binder/" style="font-size: 15px;">Binder</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">董宇.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>